## 查询主机名

```bash
[root@redhat ~]# cat /etc/hostname
redhat.example.com

[root@redhat ~]# hostname
redhat.example.com
[root@redhat ~]# hostnamectl status
   Static hostname: redhat.example.com
         Icon name: computer-vm
           Chassis: vm
        Machine ID: 364db53553224319a350fa87cbda559d
           Boot ID: b4af3e15036c440fb6db6d076397e610
    Virtualization: vmware
  Operating System: Rocky Linux 8.6 (Green Obsidian)
       CPE OS Name: cpe:/o:rocky:rocky:8:GA
            Kernel: Linux 4.18.0-372.9.1.el8.x86_64
      Architecture: x86-64
```

## 设置主机名

不同 Linux 发行版有不同的方式配置，我遇见过的两种配置方法如下

```bash
[root@redhat ~]# hostnamectl set-hostname redhat.example.com
#或
[root@redhat ~]# hostnamectl hostname redhat.example.com
```

## 名称解析

根解析器可将主机名转换为 IP 地址，或反之。它将根据 /etc/nsswitch.conf 文件的配置来确定查找位置。默认情况下，首先使用 /etc/hosts 文件来尝试解析查询。

```bash
[root@redhat ~]# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

127.0.0.1 servera servera.example.com
127.0.0.1 test
```

`getent hosts hostname` 命令使用 /etc/hosts 文件测试主机名解析。如果在 /etc/hosts 文件中未找到条目，根解析器会使用 DNS 名称服务器来查询主机名。/etc/resolv.conf 文件控制如何执行这一查询：

`search`：可使用短主机名尝试搜索的域名列表。search 或 domain 应在同一文件中设置；如果两者都设置，则仅最后一个条目生效。有关详细信息，可查看 resolc.conf(5)。
`nameserver`：要查询的名称服务器的 IP 地址。可以指定最多三个名称服务器指令，以在其中一个名称服务器停机时提供备用名称服务器。

```bash
[root@redhat ~]# cat /etc/resolv.conf
# Generated by NetworkManager
search localdomain example.com
nameserver 8.8.8.8
```

NetworkManager 使用连接配置文件中的 DNS 设置来更新 /etc/resolv.conf 文件。使用 nmcli 命令修改连接。

`nmcli con mod ID ipv4.dns IP` 命令的默认行为是将任何旧的 DNS 设置替换为提供的新 IP 列表。在 nmcli 命令 ipv4.dns 选项前面加上加号（+）或减号（-），可分别用于添加或删除个别条目。

```bash
[root@redhat ~]# nmcli connection modify ens160 ipv4.dns 8.8.8.8 +ipv4.dns 8.8.4.4
[root@redhat ~]# nmcli connection up ens160
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)
[root@redhat ~]# cat /etc/resolv.conf
# Generated by NetworkManager
search localdomain example.com
nameserver 8.8.8.8
nameserver 8.8.4.4
```

## 测试 DNS 名称解析

测试 DNS 名称解析可以使用 `dig`、`host` 等命令

`dig`、`host` 命令都不会查看 /etc/hosts 文件中的配置。若要测试 /etc/hosts 文件，请使用 `getent hosts HOSTNAME` 命令。

```bash
[root@redhat ~]# dig redhat.com

; <<>> DiG 9.11.36-RedHat-9.11.36-3.el8 <<>> redhat.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 39118
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; MBZ: 0x0005, udp: 4000
; COOKIE: 9d8a8477e9b59426 (echoed)
;; QUESTION SECTION:
;redhat.com.                    IN      A

;; ANSWER SECTION:
redhat.com.             5       IN      A       34.235.198.240
redhat.com.             5       IN      A       52.200.142.250

;; Query time: 6 msec
;; SERVER: 192.168.159.2#53(192.168.159.2)
;; WHEN: Fri Feb 02 16:23:44 CST 2024
;; MSG SIZE  rcvd: 83

[root@redhat ~]# dig -x 52.200.142.250

; <<>> DiG 9.11.36-RedHat-9.11.36-3.el8 <<>> -x 52.200.142.250
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 5200
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; MBZ: 0x0005, udp: 4000
; COOKIE: 739134fe22fcada6 (echoed)
;; QUESTION SECTION:
;250.142.200.52.in-addr.arpa.   IN      PTR

;; ANSWER SECTION:
250.142.200.52.in-addr.arpa. 5  IN      PTR     ec2-52-200-142-250.compute-1.amazonaws.com.

;; Query time: 18 msec
;; SERVER: 192.168.159.2#53(192.168.159.2)
;; WHEN: Fri Feb 02 16:24:03 CST 2024
;; MSG SIZE  rcvd: 124

[root@redhat ~]# host redhat.com
redhat.com has address 34.235.198.240
redhat.com has address 52.200.142.250
redhat.com mail is handled by 10 us-smtp-inbound-2.mimecast.com.
redhat.com mail is handled by 10 us-smtp-inbound-1.mimecast.com.

[root@redhat ~]# host 52.200.142.250
250.142.200.52.in-addr.arpa domain name pointer ec2-52-200-142-250.compute-1.amazonaws.com.
```

> DHCP 会在接口启动时自动重写 /etc/resolv.conf 文件，除非在 /etc/NetworkManager/system-connections/ 目录中存储的相关接口配置文件中指定了 `ignore-auto-dns = yes`。
>
> 使用 nmcli 命令设置这个条目。
>
> [root@redhat ~]# nmcli connection modify Wired\ connection\ 1 ipv4.ignore-auto-dns no