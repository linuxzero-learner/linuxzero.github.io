## 软件包命名

以 `openssh-8.7p1-34.el9.x86_64.rpm` 举例，`openssh` 是软件名字，`8.7p1` 是软件版本号，`34.el9` 是基于该版本的软件包的发行版号，`x86_64` 是软件包架构，`.rpm` 是后缀。

## rpm

### 常用参数

`rpm -qa`：列出所有已安装的软件包

`rpm -qf FILENAME`：确定提供 FILENAME 的软件包

```bash
[root@redhat ~]# rpm -qf /etc/yum.repos.d/
redhat-release-9.3-0.5.el9.x86_64
```

`rpm -q`：列出当前安装的软件包版本

```bash
[root@redhat ~]# rpm -q dnf
dnf-4.14.0-8.el9.noarch
```

`rpm -qi`：列出软件包的详细信息

```bash
[root@redhat ~]# rpm -qi dnf
Name        : dnf
Version     : 4.14.0
Release     : 8.el9
Architecture: noarch
Install Date: Sun 04 Feb 2024 11:06:42 AM CST
Group       : Unspecified
Size        : 2425266
License     : GPLv2+
Signature   : RSA/SHA256, Mon 10 Jul 2023 10:36:04 PM CST, Key ID 199e2f91fd431d51
Source RPM  : dnf-4.14.0-8.el9.src.rpm
Build Date  : Thu 29 Jun 2023 04:32:22 PM CST
Build Host  : x86-64-02.build.eng.rdu2.redhat.com
Packager    : Red Hat, Inc. <http://bugzilla.redhat.com/bugzilla>
Vendor      : Red Hat, Inc.
URL         : https://github.com/rpm-software-management/dnf
Summary     : Package manager
Description :
Utility that allows users to manage packages on their systems.
It supports RPMs, modules and comps groups & environments.
```

`rpm -ql`：列出软件包安装的文件

```bash
[root@redhat ~]# rpm -ql dnf
/usr/bin/dnf
/usr/lib/systemd/system/dnf-makecache.service
/usr/lib/systemd/system/dnf-makecache.timer
/usr/share/bash-completion
/usr/share/bash-completion/completions
/usr/share/bash-completion/completions/dnf
/usr/share/locale/ar/LC_MESSAGES/dnf.mo
/usr/share/locale/bg/LC_MESSAGES/dnf.mo
/usr/share/locale/bn/LC_MESSAGES/dnf.mo
/usr/share/locale/bn_IN/LC_MESSAGES/dnf.mo
/usr/share/locale/ca/LC_MESSAGES/dnf.mo
/usr/share/locale/cs/LC_MESSAGES/dnf.mo
/usr/share/locale/da/LC_MESSAGES/dnf.mo
/usr/share/locale/de/LC_MESSAGES/dnf.mo
/usr/share/locale/el/LC_MESSAGES/dnf.mo
/usr/share/locale/en_GB/LC_MESSAGES/dnf.mo
/usr/share/locale/eo/LC_MESSAGES/dnf.mo
/usr/share/locale/es/LC_MESSAGES/dnf.mo
/usr/share/locale/eu/LC_MESSAGES/dnf.mo
/usr/share/locale/fa/LC_MESSAGES/dnf.mo
/usr/share/locale/fi/LC_MESSAGES/dnf.mo
/usr/share/locale/fil/LC_MESSAGES/dnf.mo
/usr/share/locale/fr/LC_MESSAGES/dnf.mo
/usr/share/locale/fur/LC_MESSAGES/dnf.mo
/usr/share/locale/gd/LC_MESSAGES/dnf.mo
/usr/share/locale/gu/LC_MESSAGES/dnf.mo
/usr/share/locale/he/LC_MESSAGES/dnf.mo
/usr/share/locale/hi/LC_MESSAGES/dnf.mo
/usr/share/locale/hr/LC_MESSAGES/dnf.mo
/usr/share/locale/hu/LC_MESSAGES/dnf.mo
/usr/share/locale/id/LC_MESSAGES/dnf.mo
/usr/share/locale/it/LC_MESSAGES/dnf.mo
/usr/share/locale/ja/LC_MESSAGES/dnf.mo
/usr/share/locale/ka/LC_MESSAGES/dnf.mo
/usr/share/locale/kk/LC_MESSAGES/dnf.mo
/usr/share/locale/ko/LC_MESSAGES/dnf.mo
/usr/share/locale/lt/LC_MESSAGES/dnf.mo
/usr/share/locale/ml/LC_MESSAGES/dnf.mo
/usr/share/locale/mr/LC_MESSAGES/dnf.mo
/usr/share/locale/ms/LC_MESSAGES/dnf.mo
/usr/share/locale/nb/LC_MESSAGES/dnf.mo
/usr/share/locale/nl/LC_MESSAGES/dnf.mo
/usr/share/locale/or/LC_MESSAGES/dnf.mo
/usr/share/locale/pa/LC_MESSAGES/dnf.mo
/usr/share/locale/pl/LC_MESSAGES/dnf.mo
/usr/share/locale/pt/LC_MESSAGES/dnf.mo
/usr/share/locale/pt_BR/LC_MESSAGES/dnf.mo
/usr/share/locale/ru/LC_MESSAGES/dnf.mo
/usr/share/locale/si/LC_MESSAGES/dnf.mo
/usr/share/locale/sk/LC_MESSAGES/dnf.mo
/usr/share/locale/sq/LC_MESSAGES/dnf.mo
/usr/share/locale/sr/LC_MESSAGES/dnf.mo
/usr/share/locale/sr@latin/LC_MESSAGES/dnf.mo
/usr/share/locale/sv/LC_MESSAGES/dnf.mo
/usr/share/locale/th/LC_MESSAGES/dnf.mo
/usr/share/locale/tr/LC_MESSAGES/dnf.mo
/usr/share/locale/uk/LC_MESSAGES/dnf.mo
/usr/share/locale/ur/LC_MESSAGES/dnf.mo
/usr/share/locale/vi/LC_MESSAGES/dnf.mo
/usr/share/locale/zh_CN/LC_MESSAGES/dnf.mo
/usr/share/locale/zh_Hans/LC_MESSAGES/dnf.mo
/usr/share/locale/zh_TW/LC_MESSAGES/dnf.mo
/usr/share/man/man5/dnf-transaction-json.5.gz
/usr/share/man/man7/dnf.modularity.7.gz
/usr/share/man/man8/dnf.8.gz
/usr/share/man/man8/yum2dnf.8.gz
/var/cache/dnf
```

`rpm -qc`：仅列出软件包安装的配置文件

```bash
[root@redhat ~]# rpm -qc openssh-clients
/etc/ssh/ssh_config
/etc/ssh/ssh_config.d/50-redhat.conf
```

`rpm -qd`：仅列出软件包安装的文档文件

```bash
[root@redhat ~]# rpm -qd openssh-clients
/usr/share/man/man1/scp.1.gz
/usr/share/man/man1/sftp.1.gz
/usr/share/man/man1/ssh-add.1.gz
/usr/share/man/man1/ssh-agent.1.gz
/usr/share/man/man1/ssh-copy-id.1.gz
/usr/share/man/man1/ssh-keyscan.1.gz
/usr/share/man/man1/ssh.1.gz
/usr/share/man/man5/ssh_config.5.gz
/usr/share/man/man8/ssh-pkcs11-helper.8.gz
/usr/share/man/man8/ssh-sk-helper.8.gz
```

`rpm -q --scripts`：列出在安装或删除软件包之前或之后运行的 shell 脚本

```bash
[root@redhat ~]# rpm -q --scripts openssh-server
preinstall scriptlet (using /bin/sh):
getent group sshd >/dev/null || groupadd -g 74 -r sshd || :
getent passwd sshd >/dev/null || \
  useradd -c "Privilege-separated SSH" -u 74 -g sshd \
  -s /sbin/nologin -r -d /usr/share/empty.sshd sshd 2> /dev/null || :
postinstall scriptlet (using /bin/sh):


if [ $1 -eq 1 ] && [ -x "/usr/lib/systemd/systemd-update-helper" ]; then
    # Initial installation
    /usr/lib/systemd/systemd-update-helper install-system-units sshd.service sshd.socket || :
fi

# Migration scriptlet for Fedora 31 and 32 installations to sshd_config
# drop-in directory (in F32+).
# Do this only if the file generated by anaconda exists, contains our config
# directive and sshd_config contains include directive as shipped in our package
test -f /etc/sysconfig/sshd-permitrootlogin && \
  test ! -f /etc/ssh/sshd_config.d/01-permitrootlogin.conf && \
  grep -q '^PERMITROOTLOGIN="-oPermitRootLogin=yes"' /etc/sysconfig/sshd-permitrootlogin && \
  grep -q '^Include /etc/ssh/sshd_config.d/\*.conf' /etc/ssh/sshd_config && \
  echo "PermitRootLogin yes" >> /etc/ssh/sshd_config.d/25-permitrootlogin.conf && \
  rm /etc/sysconfig/sshd-permitrootlogin || :
preuninstall scriptlet (using /bin/sh):


if [ $1 -eq 0 ] && [ -x "/usr/lib/systemd/systemd-update-helper" ]; then
    # Package removal, not upgrade
    /usr/lib/systemd/systemd-update-helper remove-system-units sshd.service sshd.socket || :
fi
postuninstall scriptlet (using /bin/sh):


if [ $1 -ge 1 ] && [ -x "/usr/lib/systemd/systemd-update-helper" ]; then
    # Package upgrade, not uninstall
    /usr/lib/systemd/systemd-update-helper mark-restart-system-units sshd.service || :
fi
```

`rpm -q --changelog`：列出软件包的更改日志信息

```bash
[root@redhat ~]# rpm -q --changelog audit
* Thu Jun 22 2023 Radovan Sroka <rsroka@redhat.com> - 3.0.7-104
- Introduce new fanotify record fields
Resolves: rhbz#2216666

* Mon May 02 2022 Sergio Correia <scorreia@redhat.com> - 3.0.7-103
- Drop ProtectHome from auditd.service as it interferes with rules
  Resolves: rhbz#2071725 - Default systemd service config blocks audit watch rules in some directories [rhel-9.1.0]

* Sun Mar 13 2022 Sergio Correia <scorreia@redhat.com> - 3.0.7-102
- Fix path normalization in auparse
  Resolves: rhbz#2062824 - auparse missing information when used with --format-text

* Tue Feb 22 2022 Sergio Correia <scorreia@redhat.com> - 3.0.7-101
- Adjust sample-rules dir permissions
  Resolves: rhbz#2054432 - /usr/share/audit/sample-rules is no longer readable by non-root users

* Tue Jan 25 2022 Sergio Correia <scorreia@redhat.com> - 3.0.7-100
- New upstream release, 3.0.7
  Resolves: rhbz#2019929 - capability=unknown-capability(39) in audit messages

* Wed Nov 03 2021 Sergio Correia <scorreia@redhat.com> - 3.0.5-5
- auparse: refact nvlist cleanup code
  Resolves: rhbz#2008965

* Wed Nov 03 2021 Sergio Correia <scorreia@redhat.com> - 3.0.5-4
- When interpreting, if val is NULL return an empty string
  Resolves: rhbz#2004420

* Wed Nov 03 2021 Sergio Correia <scorreia@redhat.com> - 3.0.5-3
- Update dependency to initscripts-service instead of initscripts
  Resolves: rhbz#2000933

* Tue Aug 17 2021 Sergio Correia <scorreia@redhat.com> - 3.0.5-2
- Fix timestamp parsing
  Related: rhbz#1938680

* Mon Aug 16 2021 Sergio Correia <scorreia@redhat.com> - 3.0.5-1
- New upstream release, 3.0.5
  Related: rhbz#1938680

* Mon Aug 16 2021 Sergio Correia <scorreia@redhat.com> - 3.0.2-3
- Validates the sample rules we ship
  Resolves: rhbz#1985630

* Mon Aug 09 2021 Mohan Boddu <mboddu@redhat.com> - 3.0.2-2
- Rebuilt for IMA sigs, glibc 2.34, aarch64 flags
  Related: rhbz#1991688

* Tue Jun 22 2021 Sergio Correia <scorreia@redhat.com> - 3.0.2-1
- New upstream release, 3.0.2.
  Fix issues detected by static analyzers
  Resolves: rhbz#1938680
```

`rpm -qpl`：查询本地软件包的文件内容

```bash
[root@redhat ~]# rpm -qpl podman-4.6.1-5.el9.x86_64.rpm | head
warning: podman-4.6.1-5.el9.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID fd431d51: NOKEY
/etc/cni/net.d
/etc/cni/net.d/87-podman-bridge.conflist
/usr/bin/podman
/usr/bin/podmansh
/usr/lib/.build-id
/usr/lib/.build-id/14
/usr/lib/.build-id/14/704c8912bd4a23a1d761d997fe89a85876a8c9
/usr/lib/.build-id/1c
/usr/lib/.build-id/1c/e5f569e5be6a3c419ea13a301ece81fdd73fd1
/usr/lib/.build-id/c2
```

`rpm -ivh`：安装软件包

`rpm -e`：卸载软件包（如果由于以来原因无法卸载可以添加 `--nodeps` 参数强制卸载）

### 提取 RPM 软件包

可以通过 `rpm2cpio` 实用程序从 RPM 软件包中提取文件，而不安装此软件包。

rpm2cpio 实用程序将 RPM 软件包转换为 `cpio` 归档。将 RPM 软件包转换为 cpio 归档后，可以使用 `cpio` 命令提取文件列表。

使用 `cpio` 命令和 `-i` 选项从标准输入中提取文件，使用 `-d` 选项从当前工作目录按需创建子目录，使用 `-v` 选项提供详细输出。

```bash
[root@redhat ~]# rpm2cpio podman-4.6.1-5.el9.x86_64.rpm | cpio -idv
./usr/bin/podman
./usr/bin/podmansh
./usr/lib/.build-id
./usr/lib/.build-id/14
./usr/lib/.build-id/14/704c8912bd4a23a1d761d997fe89a85876a8c9
./usr/lib/.build-id/1c
./usr/lib/.build-id/1c/e5f569e5be6a3c419ea13a301ece81fdd73fd1
./usr/lib/.build-id/c2
./usr/lib/.build-id/c2/84d66c596a4f54c3d3021622973748ac508618
./usr/lib/.build-id/d5
./usr/lib/.build-id/d5/5fba04a75c17caf84b5854c422c09c5278e65b
./usr/lib/systemd/system-generators/podman-system-generator
./usr/lib/systemd/system/podman-auto-update.service
./usr/lib/systemd/system/podman-auto-update.timer
./usr/lib/systemd/system/podman-clean-transient.service
./usr/lib/systemd/system/podman-kube@.service
./usr/lib/systemd/system/podman-restart.service
./usr/lib/systemd/system/podman.service
./usr/lib/systemd/system/podman.socket
./usr/lib/systemd/user-generators/podman-user-generator
./usr/lib/systemd/user/podman-auto-update.service
./usr/lib/systemd/user/podman-auto-update.timer
./usr/lib/systemd/user/podman-kube@.service
./usr/lib/systemd/user/podman-restart.service
./usr/lib/systemd/user/podman.service
./usr/lib/systemd/user/podman.socket
./usr/lib/tmpfiles.d/podman.conf
./usr/libexec/podman
...output omitted...
104238 blocks
```

使用 `rpm2cpio` 和 `cpio -t` 命令，列出 RPM 软件包中的文件。使用 `cpio` 命令的 `-v` 选项提供详细输出。

```bash
[root@redhat ~]# rpm2cpio podman-4.6.1-5.el9.x86_64.rpm | cpio -tv | head -n 30
-rwxr-xr-x   1 root     root     46053520 Aug 25 19:10 ./usr/bin/podman
lrwxrwxrwx   1 root     root            6 Aug 25 19:10 ./usr/bin/podmansh -> podman
drwxr-xr-x   1 root     root            0 Aug 25 19:10 ./usr/lib/.build-id
drwxr-xr-x   1 root     root            0 Aug 25 19:10 ./usr/lib/.build-id/14
lrwxrwxrwx   1 root     root           26 Aug 25 19:10 ./usr/lib/.build-id/14/704c8912bd4a23a1d761d997fe89a85876a8c9 -> ../../../../usr/bin/podman
drwxr-xr-x   1 root     root            0 Aug 25 19:10 ./usr/lib/.build-id/1c
lrwxrwxrwx   1 root     root           38 Aug 25 19:10 ./usr/lib/.build-id/1c/e5f569e5be6a3c419ea13a301ece81fdd73fd1 -> ../../../../usr/libexec/podman/quadlet
drwxr-xr-x   1 root     root            0 Aug 25 19:10 ./usr/lib/.build-id/c2
lrwxrwxrwx   1 root     root           40 Aug 25 19:10 ./usr/lib/.build-id/c2/84d66c596a4f54c3d3021622973748ac508618 -> ../../../../usr/libexec/podman/catatonit
drwxr-xr-x   1 root     root            0 Aug 25 19:10 ./usr/lib/.build-id/d5
lrwxrwxrwx   1 root     root           43 Aug 25 19:10 ./usr/lib/.build-id/d5/5fba04a75c17caf84b5854c422c09c5278e65b -> ../../../../usr/libexec/podman/rootlessport
lrwxrwxrwx   1 root     root           31 Aug 25 19:10 ./usr/lib/systemd/system-generators/podman-system-generator -> ../../../libexec/podman/quadlet
-rw-r--r--   1 root     root          284 Aug 25 19:10 ./usr/lib/systemd/system/podman-auto-update.service
-rw-r--r--   1 root     root          143 Aug 25 19:10 ./usr/lib/systemd/system/podman-auto-update.timer
-rw-r--r--   1 root     root          667 Aug 25 19:10 ./usr/lib/systemd/system/podman-clean-transient.service
-rw-r--r--   1 root     root          443 Aug 25 19:10 ./usr/lib/systemd/system/podman-kube@.service
-rw-r--r--   1 root     root          510 Aug 25 19:10 ./usr/lib/systemd/system/podman-restart.service
-rw-r--r--   1 root     root          324 Aug 25 19:10 ./usr/lib/systemd/system/podman.service
-rw-r--r--   1 root     root          176 Aug 25 19:10 ./usr/lib/systemd/system/podman.socket
lrwxrwxrwx   1 root     root           31 Aug 25 19:10 ./usr/lib/systemd/user-generators/podman-user-generator -> ../../../libexec/podman/quadlet
-rw-r--r--   1 root     root          284 Aug 25 19:10 ./usr/lib/systemd/user/podman-auto-update.service
-rw-r--r--   1 root     root          143 Aug 25 19:10 ./usr/lib/systemd/user/podman-auto-update.timer
-rw-r--r--   1 root     root          443 Aug 25 19:10 ./usr/lib/systemd/user/podman-kube@.service
-rw-r--r--   1 root     root          510 Aug 25 19:10 ./usr/lib/systemd/user/podman-restart.service
-rw-r--r--   1 root     root          324 Aug 25 19:10 ./usr/lib/systemd/user/podman.service
-rw-r--r--   1 root     root          176 Aug 25 19:10 ./usr/lib/systemd/user/podman.socket
-rw-r--r--   1 root     root          338 Aug 25 19:10 ./usr/lib/tmpfiles.d/podman.conf
drwxr-xr-x   1 root     root            0 Aug 25 19:10 ./usr/libexec/podman
-rwxr-xr-x   1 root     root       805984 Aug 25 19:10 ./usr/libexec/podman/catatonit
-rwxr-xr-x   1 root     root      2050208 Aug 25 19:10 ./usr/libexec/podman/quadlet
```

## DNF

在红帽企业 Linux 9 中，dnf 已完全取代 yum，红帽企业 Linux 9 中的 yum 仅作为 dnf 的软连接存在。

### 列出和搜索软件包

`dnf list` 命令显示已安装和可用的软件包

```bash
[root@redhat ~]# dnf list "podman*"
Updating Subscription Management repositories.
Unable to read consumer identity

This system is not registered with an entitlement server. You can use subscription-manager to register.

Last metadata expiration check: 0:26:45 ago on Sun 04 Feb 2024 02:37:46 PM CST.
Installed Packages
podman.x86_64                             2:4.6.1-5.el9                     @AppStream
Available Packages
podman-docker.noarch                      2:4.6.1-5.el9                     AppStream
podman-gvproxy.x86_64                     2:4.6.1-5.el9                     AppStream
podman-plugins.x86_64                     2:4.6.1-5.el9                     AppStream
podman-remote.x86_64                      2:4.6.1-5.el9                     AppStream
podman-tests.x86_64                       2:4.6.1-5.el9                     AppStream
```

`dnf search KEYWORD` 命令仅列出按照名称和摘要字段中找到的关键字找到的软件包。若要搜索名称、摘要和描述字段中包含 “podman” 的软件包，可使用 search all：

```bash
[root@redhat ~]# dnf search all podman
Updating Subscription Management repositories.
Unable to read consumer identity

This system is not registered with an entitlement server. You can use subscription-manager to register.

Last metadata expiration check: 0:32:34 ago on Sun 04 Feb 2024 02:37:46 PM CST.
============================================================== Name & Description & URL Matched: podman ==============================================================
podman.x86_64 : Manage Pods, Containers and Container Images
========================================================= Name & Summary & Description & URL Matched: podman =========================================================
cockpit-podman.noarch : Cockpit component for Podman containers
podman-docker.noarch : Emulate Docker CLI using podman
podman-remote.x86_64 : A remote CLI for Podman: A Simple management tool for pods, containers and images
podman-tests.x86_64 : Tests for podman
python3-podman.noarch : RESTful API for Podman
============================================================ Name & Summary & Description Matched: podman ============================================================
pcp-pmda-podman.x86_64 : Performance Co-Pilot (PCP) metrics for podman containers
================================================================ Name & Summary & URL Matched: podman ================================================================
podman-plugins.x86_64 : Plugins for podman
===================================================================== Name & URL Matched: podman =====================================================================
podman-gvproxy.x86_64 : Go replacement for libslirp and VPNKit
=============================================================== Summary & Description Matched: podman ================================================================
container-tools.noarch : A meta-package witch container tools such as podman, buildah, skopeo, etc.
==================================================================== Description Matched: podman =====================================================================
containers-common.x86_64 : Common configuration and documentation for containers
netavark.x86_64 : OCI network stack
toolbox.x86_64 : Tool for containerized command line environments on Linux
virt-what.x86_64 : Detect if we are running in a virtual machine
```

### 查询软件包信息

`dnf info PACKAGENAME` 命令返回与软件包相关的详细信息，包括安装所需的磁盘空间。

```bash
[root@redhat ~]# dnf info podman
Updating Subscription Management repositories.
Unable to read consumer identity

This system is not registered with an entitlement server. You can use subscription-manager to register.

Last metadata expiration check: 0:33:59 ago on Sun 04 Feb 2024 02:37:46 PM CST.
Installed Packages
Name         : podman
Epoch        : 2
Version      : 4.6.1
Release      : 5.el9
Architecture : x86_64
Size         : 51 M
Source       : podman-4.6.1-5.el9.src.rpm
Repository   : @System
From repo    : AppStream
Summary      : Manage Pods, Containers and Container Images
URL          : https://podman.io/
License      : Apache-2.0 AND BSD-2-Clause AND BSD-3-Clause AND ISC AND MIT AND MPL-2.0
Description  : podman (Pod Manager) is a fully featured container engine that is a simple
             : daemonless tool.  podman provides a Docker-CLI comparable command line that
             : eases the transition from other container engines and allows the management of
             : pods, containers and images.  Simply put: alias docker=podman.
             : Most podman commands can be run as a regular user, without requiring
             : additional privileges.
             :
             : podman uses Buildah(1) internally to create container images.
             : Both tools share image (not container) storage, hence each can use or
             : manipulate images (but not containers) created by the other.
             :
             : Manage Pods, Containers and Container Images
             : podman Simple management tool for pods, containers and images
```

### 按照某个命令或文件查询软件包

`dnf provides PATHNAME` 命令显示与指定路径名匹配的软件包（路径名通常包含通配符）。

```bash
[root@redhat ~]# dnf provides podman
Updating Subscription Management repositories.
Unable to read consumer identity

This system is not registered with an entitlement server. You can use subscription-manager to register.

Last metadata expiration check: 0:36:37 ago on Sun 04 Feb 2024 02:37:46 PM CST.
podman-2:4.6.1-5.el9.x86_64 : Manage Pods, Containers and Container Images
Repo        : @System
Matched from:
Provide    : podman = 2:4.6.1-5.el9

podman-2:4.6.1-5.el9.x86_64 : Manage Pods, Containers and Container Images
Repo        : AppStream
Matched from:
Provide    : podman = 2:4.6.1-5.el9
```

### 安装、更新和卸载软件包

`dnf install PACKAGENAME` 命令获取并安装软件包，包括所有依赖项

`dnf update PACKAGENAME` 命令获取并安装指定软件包的较新版本，包括所有依赖项。通常，该过程会保留配置文件，但在某些情况下，如果打包商认为旧名称在更新后将无法使用，则可能对这些文件进行重命名。如果未指定 PACKAGENAME，它将安装所有相关更新。

由于新内核只有通过引导至该内核才能进行测试，软件包进行了特殊设计，以便一次能够安装多个版本。如果新内核启动失败，则依然可以使用旧内核。运行 `dnf update kernel` 命令可安装新内核。配置文件中保存一份软件包列表，即使在管理员要求更新时也始终安装这些软件包。

使用 `dnf list kernel` 命令可列出所有已安装和可用的内核。若要查看当前运行的内核，请使用 `uname` 命令。`uname` 命令 `-r` 选项仅显示内核的版本和发行版本，而 `uname` 命令 `-a` 选项则显示内核发行版和其他信息。

`dnf remove PACKAGENAME` 命令可删除安装的软件包，包括所有受支持的软件包

> `dnf remove` 命令将删除列出的软件包和需要待删除软件包的任何软件包（以及需要这些软件包的软件包，以此类推）。此命令会导致意外删除软件包，因此请仔细检查要删除的软件包列表。
>
> 总结：`dnf remove` 会卸载很多东西，不要用它卸载软件。

### 安装、更新和卸载软件包组

dnf 命令具有组的概念，支持安装一系列软件包。

在红帽企业 Linux 9 中，dnf 命令可以安装两种软件包组。常规组时软件包的集合。环境组时常规组的集合。这些集合提供的软件包或组可以列为 mandatory （安装改组时必须予以安装）、default（安装该组时通常会安装），或 optional （安装该组时不予安装，除非特别要求）。

与 `dnf list` 命令类似，`dnf group list` 命令可显示和可用的组的名称。

有些组一般通过环境组安装，默认为隐藏。可通过 `dnf group list hidden` 命令列出这些隐藏组。

`dnf group info` 命令显示与组相关的信息。其中包含必选、默认和可选的软件包名称。

```bash
[root@redhat ~]# dnf groupinfo "RPM Development Tools"
Updating Subscription Management repositories.
Unable to read consumer identity

This system is not registered with an entitlement server. You can use subscription-manager to register.

Last metadata expiration check: 1:19:36 ago on Sun 04 Feb 2024 02:37:46 PM CST.
Group: RPM Development Tools
 Description: Tools used for building RPMs, such as rpmbuild.
 Mandatory Packages:
   redhat-rpm-config
   rpm-build
 Default Packages:
   rpmdevtools
 Optional Packages:
   rpmlint
```

`dnf group install` 命令将安装一个组，同时安装其必选和默认的软件包，以及他们依赖的软件包。

> 自红帽企业 Linux 7 起，Yum 组的行为发生了变化，他们被视为对象并由系统进行跟踪。如果安装的组有了更新，并且 Yum 存储库将新的必选项或默认软件包添加到了该组中，则更新时也会安装这些新软件包。
>
> RHEL 6 和更早版本在组满足以下任何条件时将其视为已经安装；该组的所有必选软件包已经安装；该组没有任何必选软件包；或者，安装了该组中的任何默认或可选软件包。自 RHEL 7 起，只有使用 `yum group install` 安装了某个组，该组才被视为已经安装。您可以使用 `yum group mark install GROUPNAME` 命令将组标记为已安装，下一次更新时将安装任何缺少的软件包和其依赖项。
>
> RHEL 6 和更早版本没有 `yum group` 命令的双词形式。换而言之，RHEL 6 中存在 `yum grouplist` 命令，但不存在与其等效的 RHEL 7 和 RHEL 8 `yum group list` 命令。

### 查看事务历史记录

所有安装和删除事务的日志都记录在 /var/log/dnf.rpm.log 中。

```bash
[root@redhat ~]# tail /var/log/dnf.rpm.log
2024-02-04T16:16:11+0800 INFO --- logging initialized ---
2024-02-04T16:18:09+0800 INFO --- logging initialized ---
2024-02-04T16:18:11+0800 INFO --- logging initialized ---
2024-02-04T16:18:11+0800 INFO --- logging initialized ---
2024-02-04T16:18:12+0800 INFO --- logging initialized ---
2024-02-04T16:18:15+0800 INFO --- logging initialized ---
2024-02-04T16:18:18+0800 SUBDEBUG Installed: nginx-filesystem-1:1.20.1-14.el9_2.1.noarch
2024-02-04T16:18:18+0800 SUBDEBUG Installed: nginx-core-1:1.20.1-14.el9_2.1.x86_64
2024-02-04T16:18:18+0800 SUBDEBUG Installed: redhat-logos-httpd-90.4-2.el9.noarch
2024-02-04T16:18:18+0800 SUBDEBUG Installed: nginx-1:1.20.1-14.el9_2.1.x86_64
```

`dnf history` 命令显示安装和删除事务的摘要。

```bash
[root@redhat ~]# dnf history
Updating Subscription Management repositories.
Unable to read consumer identity

This system is not registered with an entitlement server. You can use subscription-manager to register.

ID     | Command line                                      | Date and time    | Action(s)      | Altered
--------------------------------------------------------------------------------------------------------
     2 | install nginx                                     | 2024-02-04 16:18 | Install        |    4
     1 |                                                   | 2024-02-04 11:05 | Install        | 1201 EE
```

`dnf history undo` 命令可以撤销事务。

```bash
[root@redhat ~]# dnf history undo 2
Updating Subscription Management repositories.
Unable to read consumer identity

This system is not registered with an entitlement server. You can use subscription-manager to register.

Last metadata expiration check: 0:05:52 ago on Sun 04 Feb 2024 04:16:11 PM CST.
Dependencies resolved.
======================================================================================================================================================================
 Package                                     Architecture                    Version                                        Repository                           Size
======================================================================================================================================================================
Removing:
 nginx                                       x86_64                          1:1.20.1-14.el9_2.1                            @AppStream                          148 k
Removing dependent packages:
 nginx-core                                  x86_64                          1:1.20.1-14.el9_2.1                            @AppStream                          1.6 M
 nginx-filesystem                            noarch                          1:1.20.1-14.el9_2.1                            @AppStream                            0
 redhat-logos-httpd                          noarch                          90.4-2.el9                                     @AppStream                           12 k

Transaction Summary
======================================================================================================================================================================
Remove  4 Packages

Freed space: 1.8 M
Is this ok [y/N]: y
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                                                                                              1/1
  Running scriptlet: nginx-1:1.20.1-14.el9_2.1.x86_64                                                                                                             1/4
  Erasing          : nginx-1:1.20.1-14.el9_2.1.x86_64                                                                                                             1/4
  Running scriptlet: nginx-1:1.20.1-14.el9_2.1.x86_64                                                                                                             1/4
  Erasing          : redhat-logos-httpd-90.4-2.el9.noarch                                                                                                         2/4
  Erasing          : nginx-core-1:1.20.1-14.el9_2.1.x86_64                                                                                                        3/4
  Erasing          : nginx-filesystem-1:1.20.1-14.el9_2.1.noarch                                                                                                  4/4
  Running scriptlet: nginx-filesystem-1:1.20.1-14.el9_2.1.noarch                                                                                                  4/4
  Verifying        : nginx-1:1.20.1-14.el9_2.1.x86_64                                                                                                             1/4
  Verifying        : nginx-core-1:1.20.1-14.el9_2.1.x86_64                                                                                                        2/4
  Verifying        : nginx-filesystem-1:1.20.1-14.el9_2.1.noarch                                                                                                  3/4
  Verifying        : redhat-logos-httpd-90.4-2.el9.noarch                                                                                                         4/4
Installed products updated.

Removed:
  nginx-1:1.20.1-14.el9_2.1.x86_64    nginx-core-1:1.20.1-14.el9_2.1.x86_64    nginx-filesystem-1:1.20.1-14.el9_2.1.noarch    redhat-logos-httpd-90.4-2.el9.noarch

Complete!
```

### DNF 命令摘要

| 任务                           | 命令                        |
| ------------------------------ | --------------------------- |
| 按名称列出已安装和可用的软件包 | dnf list [NAME-PATTERN]     |
| 列出已安装和可用的组           | dnf group list              |
| 按关键字搜索软件包             | dnf search KEYWORD          |
| 显示软件包的详细信息           | dnf info PACKAGENAME        |
| 安装软件包                     | dnf install PACKAGENAME     |
| 安装软件包组                   | dnf group install GROUPNAME |
| 更新软件包                     | dnf update                  |
| 删除软件包                     | dnf remove PACKAGENAME      |
| 显示事务历史记录               | dnf history                 |

### 通过 dnf 管理软件包模块流

从传统上看，管理应用软件包的备用版本及其相关软件包意味着为每个版本维护不同的存储库。如果开发人员想要最新版本的应用，而管理员希望获得该应用的最稳定版本，就会造成一种难以管理的繁琐局面。红帽通过使用一种称为模块化的技术来简化此过程。借助模块化，单个存储库可以承载应用软件包及其依赖项的多个版本。

#### BaseOS 和应用流简介

红帽企业 Linux 9 通过两个主要的软件存储库分发内容，分别为 `BaseOS` 和 `AppStream`（应用流）。

BaseOS 存储库以 RPM 软件包形式为红帽企业 Linux 提供核心操作系统内容。BaseOS 组件的生命周期与之前红帽企业 Linux 发行版中的内容相同。应用流存储库提供具有不同生命周期的内容，作为模块和传统软件包。

应用流包含系统的必要部分，以及以前作为红帽软件集合的一部分提供的各种应用，及其他产品和程序。每个应用流的生命周期与红帽企业 Linux 9 相同或更短。

BaseOS 和 AppStream 都是红帽企业 Linux 9 系统的必要部分。

应用流存储库包含两种类型的内容：模块和传统的 RPM 软件包。模块描述了属于一个整体的一组 RPM 软件包。模块可以包含多个流，使多个版本的应用可供安装。启用模块流后，系统能够访问该模块流中的 RPM 软件包。通常，模块围绕软件应用或编程语言的特定版本来整理 RPM 软件包。一个典型的模块中包含应用软件包、应用特定依赖库软件包、应用文档的软件包，以及帮助器实用程序的软件包。

> 红帽企业 Linux 9.0 不随附模块。RHEL 9 的未来版本可能会以模块形式引入其他内容和更新版本的软件。此外，从RHEL 9 开始，必须手动指定默认模块流，因为它们不在默认定义。可以使用 `/etc/dnf/modules.defaults.d/` 目录中的配置文件来定义默认模块流。

#### 模块流

每个模块流具有一个或多个模块流，其包含不同版本的内容。每个流独立接受更新。模块流可以视为应用流物理存储库中的虚拟存储库。

对于每个模块，只能启用其中一个流，这个流将提供所含的软件包。

#### 模块配置集

每个模块可以有一个或多个配置集。配置集是要为特定用例一起安装的软件包的列表，这些用例包括服务器、客户端、开发和最小安装等。

安装特定的模块配置集就是从模块流安装一组特定的软件包。随后可以正常安装或卸载软件包。如果未指定配置集，模块将安装他的默认配置集。

#### 通过 DNF 管理模块

红帽企业 Linux 9 支持应用流的模块化功能。要处理模块化内容，您可以使用 `dnf module` 命令。否则，dnf 命令安装与常规软件包类似的方式处理模块。

可以在以下列表中找到管理模块时使用的一些重要命令：

`dnf module list`：列出可用的模块，以及模块名称、流、配置集和摘要
`dnf module list module-name`：列出特定模块的模块流并检索其状态
`dnf module info module-info`：显示模块的详细信息，包括可用的配置集和模块安装的软件包列表。在不指定模块流的情况下运行 `dnf module info` 命令，将列出从默认配置集和流安装的软件包。使用 `module-name:stream` 格式来查看特定的模块流。添加 `--profile` 选项可显示有关各个模块的配置集所安装的软件包的信息。
`dnf module provides packages`：显示哪个模块提供特定的软件包。

### 启用 DNF 存储库

#### 启用和禁用软件存储库

`dnf repolist all` 命令可以列出所有的软件存储库

```bash
[root@redhat yum.repos.d]# yum repolist all
repo id                                             repo name                                                                                                 status
AppStream                                           AppStream                                                                                                 enabled
BaseOS                                              BaseOS                                                                                                    enabled
appstream                                           Rocky Linux 8 - AppStream                                                                                 enabled
appstream-debug                                     Rocky Linux 8 - AppStream - Source                                                                        disabled
appstream-source                                    Rocky Linux 8 - AppStream - Source                                                                        disabled
baseos                                              Rocky Linux 8 - BaseOS                                                                                    enabled
baseos-debug                                        Rocky Linux 8 - BaseOS - Source                                                                           disabled
baseos-source                                       Rocky Linux 8 - BaseOS - Source                                                                           disabled
devel                                               Rocky Linux 8 - Devel WARNING! FOR BUILDROOT AND KOJI USE                                                 disabled
epel                                                Extra Packages for Enterprise Linux 8 - x86_64                                                            enabled
epel-debuginfo                                      Extra Packages for Enterprise Linux 8 - x86_64 - Debug                                                    disabled
epel-modular                                        Extra Packages for Enterprise Linux Modular 8 - x86_64 - RETIRED                                          disabled
epel-modular-debuginfo                              Extra Packages for Enterprise Linux Modular 8 - x86_64 - Debug - RETIRED                                  disabled
epel-modular-source                                 Extra Packages for Enterprise Linux Modular 8 - x86_64 - Source - RETIRED                                 disabled
epel-source                                         Extra Packages for Enterprise Linux 8 - x86_64 - Source                                                   disabled
epel-testing                                        Extra Packages for Enterprise Linux 8 - Testing - x86_64                                                  disabled
epel-testing-debuginfo                              Extra Packages for Enterprise Linux 8 - Testing - x86_64 - Debug                                          disabled
epel-testing-modular                                Extra Packages for Enterprise Linux Modular 8 - Testing - x86_64 - RETIRED                                disabled
epel-testing-modular-debuginfo                      Extra Packages for Enterprise Linux Modular 8 - Testing - x86_64 - Debug - RETIRED                        disabled
epel-testing-modular-source                         Extra Packages for Enterprise Linux Modular 8 - Testing - x86_64 - Source - RETIRED                       disabled
epel-testing-source                                 Extra Packages for Enterprise Linux 8 - Testing - x86_64 - Source                                         disabled
extras                                              Rocky Linux 8 - Extras                                                                                    enabled
ha                                                  Rocky Linux 8 - HighAvailability                                                                          disabled
ha-debug                                            Rocky Linux 8 - High Availability - Source                                                                disabled
ha-source                                           Rocky Linux 8 - High Availability - Source                                                                disabled
media-appstream                                     Rocky Linux 8 - Media - AppStream                                                                         disabled
media-baseos                                        Rocky Linux 8 - Media - BaseOS                                                                            disabled
nfv                                                 Rocky Linux 8 - NFV                                                                                       disabled
plus                                                Rocky Linux 8 - Plus                                                                                      disabled
powertools                                          Rocky Linux 8 - PowerTools                                                                                enabled
powertools-debug                                    Rocky Linux 8 - PowerTools - Source                                                                       disabled
powertools-source                                   Rocky Linux 8 - PowerTools - Source                                                                       disabled
resilient-storage                                   Rocky Linux 8 - ResilientStorage                                                                          disabled
resilient-storage-debug                             Rocky Linux 8 - Resilient Storage - Source                                                                disabled
resilient-storage-source                            Rocky Linux 8 - Resilient Storage - Source                                                                disabled
rt                                                  Rocky Linux 8 - Realtime                                                                                  disabled
```

`dnf config-manager` 命令可以启用或禁用存储库。

```bash
[root@redhat yum.repos.d]# dnf config-manager --enable ha
[root@redhat yum.repos.d]# dnf repolist all | grep ha
ha                             Rocky Linux 8 - HighAvailability         enabled
ha-debug                       Rocky Linux 8 - High Availability - Sour disabled
ha-source                      Rocky Linux 8 - High Availability - Sour disabled
```

> RHEL 9 可以在 `/etc/yum.repos.d/` 或 `/etc/dnf/dnf.conf` 配置存储库，但是建议在  `/etc/yum.repos.d/` 配置，而且 `/etc/yum.repos.d/` 的优先级也比 `/etc/dnf/dnf.conf` 高。

### 添加 DNF 存储库

```bash
[root@redhat yum.repos.d]# dnf config-manager --add-repo="https://dl.fedoraproject.org/pub/epel/9/Everything/x86_64/"
Updating Subscription Management repositories.
Unable to read consumer identity

This system is not registered with an entitlement server. You can use subscription-manager to register.

Adding repo from: https://dl.fedoraproject.org/pub/epel/9/Everything/x86_64/

```

rpm 命令使用 GPG 密钥签署软件包，并导入公钥已验证软件包的完整性和真实性。dnf 命令使用存储库配置文件提供 GPG 公钥位置，并导入密钥以验证软件包。密钥存储在远程存储库站点上的不同位置，如 `https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-9`。管理员应将密钥下载到本地，而不是让 dnf 命令从外部源检索该密钥。

```bash
[root@redhat yum.repos.d]# cat dl.fedoraproject.org_pub_epel_9_Everything_x86_64_.repo
[dl.fedoraproject.org_pub_epel_9_Everything_x86_64_]
name=created by dnf config-manager from https://dl.fedoraproject.org/pub/epel/9/Everything/x86_64/
baseurl=https://dl.fedoraproject.org/pub/epel/9/Everything/x86_64/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-9
```

### 本地存储库的 RPM 配置软件包

一些存储库将配置文件和 GPG 公钥作为 RPM 软件包的一部分来提供，以简化它们的安装。可以使用 `rpm --import` 命令导入 GPG 公钥。`dnf install` 命令可以下载并安装这些 RPM 软件包。

例如，以下命令导入 RPM-GPG-KEY-EPEL-9 (EPEL) GPG 公钥并安装 RHEL 9 Extra Packages for Enterprise Linux (EPEL) 存储库 RPM：

```bash
[root@redhat rpm-gpg]# rpm --import \
https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-9
[root@redhat rpm-gpg]# dnf install \
https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm
```

> 在安装以签名的软件包之前，导入 RPM GPG 密钥来确保软件包来自受信任的来源。如果未导入 RPM GPG 密钥，则 dnf 命令无法安装已签名的软件包。
>
> dnf 命令 `--nogpgcheck` 选项会忽略缺少的 GPG 密钥，但可能会导致安装受损或伪造的安装包。

```bash
[root@redhat yum.repos.d]# cat /etc/yum.repos.d/epel*
[epel-cisco-openh264]
name=Extra Packages for Enterprise Linux $releasever openh264 (From Cisco) - $basearch
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-cisco-openh264-$releasever&arch=$basearch
type=rpm
enabled=1
metadata_expire=14d
repo_gpgcheck=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
skip_if_unavailable=True

[epel-cisco-openh264-debuginfo]
name=Extra Packages for Enterprise Linux $releasever openh264 (From Cisco) - $basearch - Debug
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-cisco-openh264-debug-$releasever&arch=$basearch
type=rpm
enabled=0
metadata_expire=14d
repo_gpgcheck=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
skip_if_unavailable=True

[epel-cisco-openh264-source]
name=Extra Packages for Enterprise Linux $releasever openh264 (From Cisco) - $basearch - Source
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-cisco-openh264-source-$releasever&arch=$basearch
type=rpm
enabled=0
metadata_expire=14d
repo_gpgcheck=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
skip_if_unavailable=True

[epel]
name=Extra Packages for Enterprise Linux $releasever - $basearch
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/$releasever/Everything/$basearch/
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=1
gpgcheck=1
countme=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever

[epel-debuginfo]
name=Extra Packages for Enterprise Linux $releasever - $basearch - Debug
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/$releasever/Everything/$basearch/debug/
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
gpgcheck=1

[epel-source]
name=Extra Packages for Enterprise Linux $releasever - $basearch - Source
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/$releasever/Everything/source/tree/
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-source-$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
gpgcheck=1
[epel-testing]
name=Extra Packages for Enterprise Linux $releasever - Testing - $basearch
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/testing/$releasever/Everything/$basearch/
metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-epel$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=0
gpgcheck=1
countme=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever

[epel-testing-debuginfo]
name=Extra Packages for Enterprise Linux $releasever - Testing - $basearch - Debug
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/testing/$releasever/Everything/$basearch/debug/
metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-debug-epel$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
gpgcheck=1

[epel-testing-source]
name=Extra Packages for Enterprise Linux $releasever - Testing - $basearch - Source
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/testing/$releasever/Everything/source/tree/
metalink=https://mirrors.fedoraproject.org/metalink?repo=testing-source-epel$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
gpgcheck=1
```

要定义存储库，但不默认搜索它，请插入 `enabled=0` 参数。虽然 `dnf config-manager` 命令可持久启用和禁用存储库，但 dnf 命令的 `--enablerepo=PATTERN` 和 `--disablerepo=PATTERN` 选项是临时的，仅覆盖命令运行期间。